<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Page Cast: Live HTML Hosting</title>
    <style>
        /* --- 1. Global Styles & Variables --- */
        :root {
            --primary-color: #3498db; --secondary-color: #2980b9; --success-color: #1abc9c;
            --error-color: #e74c3c; --light-gray: #f4f7f9; --dark-gray: #2c3e50;
            --border-color: #ccc; --resizer-color: #bdc3c7;
        }
        html, body { height: 100%; margin: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--light-gray); color: #333; padding: 20px;
            box-sizing: border-box; overflow: hidden;
        }
        .container {
            background-color: #fff; padding: 30px; border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); width: 100%; max-width: 1600px;
            margin: 0 auto; display: flex; flex-direction: column; height: calc(100vh - 40px);
        }

        /* --- 2. Header & Controls --- */
        .header-controls { flex-shrink: 0; }
        h1 { text-align: center; color: var(--dark-gray); margin: 0 0 5px; font-size: 1.8em; }
        .subtitle { text-align: center; margin: 0 0 20px; color: #7f8c8d; }
        .step { margin-bottom: 20px; }
        label { display: block; font-weight: 600; margin-bottom: 8px; }
        input[type="password"] {
            width: 100%; padding: 10px; border: 1px solid var(--border-color);
            border-radius: 4px; box-sizing: border-box; font-size: 1rem;
        }
        .token-help { font-size: 0.85em; color: #666; }
        .token-help a { color: var(--primary-color); text-decoration: none; }
        .input-error { color: var(--error-color); font-size: 0.85em; margin-top: 5px; min-height: 1.2em; }

        /* --- 3. Main Editor/Preview Layout (Desktop) --- */
        .view-switcher { display: none; }
        .editor-preview-container { display: flex; flex-grow: 1; min-height: 300px; }
        .pane { display: flex; flex-direction: column; min-width: 50px; }
        .editor-pane { flex-basis: 50%; }
        .preview-pane { flex: 1; }
        .resizer {
            flex-basis: 10px; flex-shrink: 0; background-color: var(--resizer-color);
            cursor: col-resize; margin: 0 5px; border-radius: 5px; transition: background-color 0.2s;
        }
        .resizer:hover { background-color: var(--secondary-color); }
        textarea, iframe {
            width: 100%; height: 100%; border: 1px solid var(--border-color);
            border-radius: 4px; box-sizing: border-box;
        }
        textarea { resize: none; font-family: "Courier New", monospace; font-size: 0.95em; padding: 10px; }
        iframe { background-color: #fff; }
        .pane-header { display: flex; justify-content: space-between; align-items: center; }
        #fullscreen-toggle { cursor: pointer; padding: 2px; }
        #fullscreen-toggle svg { width: 18px; height: 18px; vertical-align: middle; }
        #icon-exit-fs { display: none; }

        /* --- 4. Buttons, Results & Footer --- */
        #create-btn { margin-top: 20px; flex-shrink: 0; }
        button {
            display: block; width: 100%; padding: 12px; background-color: var(--primary-color);
            color: white; border: none; border-radius: 4px; font-size: 1.1em;
            font-weight: 600; cursor: pointer; transition: background-color 0.2s;
        }
        button:hover { background-color: var(--secondary-color); }
        button:disabled { background-color: #bdc3c7; cursor: not-allowed; }
        #result {
            margin-top: 20px; padding: 15px; border-radius: 4px;
            word-wrap: break-word; display: none; flex-shrink: 0; border: 1px solid transparent;
        }
        #result h3 { margin: 0 0 10px; }
        #result.success { background-color: #e8f6ef; border-color: #d1e7dd; }
        #result.error { background-color: #f8d7da; border-color: #f5c6cb; color: #721c24; }
        .copy-button { background-color: var(--success-color); margin-top: 10px; font-size: 0.9em; padding: 8px; }
        .footer {
            margin-top: auto; /* Pushes footer to the bottom of the flex container */
            padding-top: 20px;
            text-align: center;
            font-size: 0.85em;
            color: #7f8c8d;
            flex-shrink: 0;
        }
        .footer a { color: var(--secondary-color); text-decoration: none; }
        .footer a:hover { text-decoration: underline; }

        /* --- 5. Mobile Responsive Styles (Breakpoint: 800px) --- */
        @media (max-width: 800px) {
            body { padding: 10px; overflow: auto; }
            .container { padding: 15px; height: auto; min-height: calc(100vh - 20px); }
            h1 { font-size: 1.5em; }
            .view-switcher {
                display: flex; margin-bottom: 10px; border: 1px solid var(--border-color);
                border-radius: 4px; overflow: hidden;
            }
            .view-switcher button {
                flex: 1; padding: 10px; border: none; background-color: #fff;
                color: var(--dark-gray); font-size: 1em; border-radius: 0;
            }
            .view-switcher button.active { background-color: var(--primary-color); color: #fff; }
            .editor-preview-container { flex-direction: column; height: 60vh; }
            .pane { display: none; width: 100%; height: 100%; }
            .pane.active { display: flex; }
            .resizer, #fullscreen-toggle { display: none; }
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="header-controls">
            <h1>Page Cast</h1>
            <p class="subtitle">Instantly host your HTML with a live preview.</p>
            <div class="step">
                <label for="github-token">1. GitHub Personal Access Token</label>
                <input type="password" id="github-token" placeholder="Paste token to enable hosting">
                <div id="token-error" class="input-error"></div>
                <p class="token-help">
                    <a href="https://github.com/settings/tokens/new?scopes=gist&description=Page%20Cast%20App" target="_blank">Create a token</a> with <strong>`gist`</strong> scope. It's saved securely in your browser.
                </p>
            </div>
        </div>

        <div class="view-switcher">
            <button id="show-editor-btn" class="active">Editor</button>
            <button id="show-preview-btn">Preview</button>
        </div>

        <div class="editor-preview-container">
            <div class="pane editor-pane active" id="editor-pane">
                <label for="html-content">2. Code Editor</label>
                <textarea id="html-content" placeholder="<!-- Paste your HTML code here -->"></textarea>
            </div>
            <div class="resizer" id="resizer"></div>
            <div class="pane preview-pane" id="preview-pane">
                <div class="pane-header">
                    <label>Live Interactive Preview</label>
                    <span id="fullscreen-toggle" title="Toggle Fullscreen">
                        <svg id="icon-enter-fs" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path></svg>
                        <svg id="icon-exit-fs" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"></path></svg>
                    </span>
                </div>
                <iframe id="preview-frame" title="Live HTML Preview"></iframe>
            </div>
        </div>

        <button id="create-btn">3. Cast Page</button>
        <div id="result"></div>
        
        <div class="footer">
            Created by <a href="https://github.com/Romelium" target="_blank">Romelium</a>.
            This tool is a single HTML file; feel free to save and use it offline.
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- 1. ELEMENT SELECTION ---
            // Cache all DOM elements for performance and cleaner code.
            const elements = {
                tokenInput: document.getElementById('github-token'),
                htmlInput: document.getElementById('html-content'),
                createBtn: document.getElementById('create-btn'),
                resultDiv: document.getElementById('result'),
                previewFrame: document.getElementById('preview-frame'),
                resizer: document.getElementById('resizer'),
                editorPane: document.getElementById('editor-pane'),
                previewPane: document.getElementById('preview-pane'),
                fullscreenToggle: document.getElementById('fullscreen-toggle'),
                showEditorBtn: document.getElementById('show-editor-btn'),
                showPreviewBtn: document.getElementById('show-preview-btn'),
                tokenError: document.getElementById('token-error'),
            };

            // --- 2. STATE & INITIALIZATION ---
            let isResizing = false;
            const savedToken = localStorage.getItem('githubApiToken');
            if (savedToken) elements.tokenInput.value = savedToken;
            updatePreview();

            // --- 3. EVENT LISTENERS ---
            elements.showEditorBtn.addEventListener('click', () => switchTabView(true));
            elements.showPreviewBtn.addEventListener('click', () => switchTabView(false));
            elements.resizer.addEventListener('mousedown', () => { isResizing = true; document.body.style.cursor = 'col-resize'; });
            document.addEventListener('mousemove', handleResize);
            document.addEventListener('mouseup', () => { isResizing = false; document.body.style.cursor = 'default'; });
            elements.fullscreenToggle.addEventListener('click', () => document.body.classList.toggle('fullscreen-preview'));
            elements.htmlInput.addEventListener('input', debounce(updatePreview, 300));
            elements.tokenInput.addEventListener('input', handleTokenInput);
            elements.createBtn.addEventListener('click', handleCreateLink);

            // --- 4. CORE LOGIC FUNCTIONS ---

            /** Switches between Editor and Preview tabs on mobile view. */
            function switchTabView(showEditor) {
                elements.editorPane.classList.toggle('active', showEditor);
                elements.previewPane.classList.toggle('active', !showEditor);
                elements.showEditorBtn.classList.toggle('active', showEditor);
                elements.showPreviewBtn.classList.toggle('active', !showEditor);
            }

            /** Handles the mouse move event to resize the editor pane. */
            function handleResize(e) {
                if (!isResizing) return;
                const container = elements.resizer.parentElement;
                const pointerRelativeX = e.clientX - container.offsetLeft;
                const newEditorWidth = (pointerRelativeX - elements.resizer.offsetWidth / 2) / container.clientWidth * 100;
                if (newEditorWidth > 10 && newEditorWidth < 90) {
                    elements.editorPane.style.flexBasis = `${newEditorWidth}%`;
                }
            }

            /** Updates the content of the preview iframe. */
            function updatePreview() {
                elements.previewFrame.srcdoc = elements.htmlInput.value;
            }

            /** Validates token format and saves it to local storage. */
            function handleTokenInput() {
                const token = elements.tokenInput.value;
                localStorage.setItem('githubApiToken', token);
                if (token && !token.startsWith('ghp_') && !token.startsWith('github_pat_')) {
                    elements.tokenError.textContent = 'Warning: This does not look like a valid GitHub token.';
                } else {
                    elements.tokenError.textContent = '';
                }
            }

            /** Main logic for creating the Gist and displaying the result. */
            async function handleCreateLink() {
                const token = elements.tokenInput.value.trim();
                const htmlContent = elements.htmlInput.value.trim();

                if (!token) return showResult('error', '<h3>Error</h3>GitHub token is missing.');
                if (!htmlContent) return showResult('error', '<h3>Error</h3>HTML content is empty.');

                elements.createBtn.disabled = true;
                elements.createBtn.textContent = 'Casting...';
                
                try {
                    const rawUrl = await createGist(token, htmlContent);
                    const githackUrl = convertToGithack(rawUrl);
                    const successMessage = `<h3>Success!</h3>Your permanent URL is ready:<br><a href="${githackUrl}" target="_blank">${githackUrl}</a>`;
                    showResult('success', successMessage);
                    addCopyButton(githackUrl);
                } catch (error) {
                    let errorMessage = '<h3>Error</h3>';
                    if (error.isNetworkError) {
                        errorMessage += 'Could not connect to GitHub. Please check your internet connection.';
                    } else if (error.status) {
                        switch (error.status) {
                            case 401: errorMessage += 'Authentication Failed. Please check that your token is correct and has the `gist` scope.'; break;
                            case 403: errorMessage += 'Forbidden. You may have hit the API rate limit. Please wait a moment and try again.'; break;
                            case 404: errorMessage += 'API Not Found. This is an unexpected error.'; break;
                            default: errorMessage += `An API error occurred (Status ${error.status}). ${error.data?.message || 'Please try again.'}`;
                        }
                    } else {
                        errorMessage += `An unknown error occurred: ${error.message}`;
                    }
                    showResult('error', errorMessage);
                } finally {
                    elements.createBtn.disabled = false;
                    elements.createBtn.textContent = '3. Cast Page';
                }
            }

            /** Displays a message in the result area. */
            function showResult(type, message) {
                elements.resultDiv.style.display = 'block';
                elements.resultDiv.className = type;
                elements.resultDiv.innerHTML = message;
            }

            /** Adds a "Copy to Clipboard" button to the result area. */
            function addCopyButton(url) {
                const copyBtn = document.createElement('button');
                copyBtn.textContent = 'Copy URL to Clipboard';
                copyBtn.className = 'copy-button';
                copyBtn.onclick = async () => {
                    try {
                        await navigator.clipboard.writeText(url);
                        copyBtn.textContent = 'Copied!';
                        setTimeout(() => { copyBtn.textContent = 'Copy URL to Clipboard'; }, 2000);
                    } catch (err) {
                        alert('Failed to copy URL to clipboard. Please copy it manually.');
                    }
                };
                elements.resultDiv.appendChild(copyBtn);
            }

            // --- 5. API & UTILITY FUNCTIONS ---

            /** Creates a public Gist and returns the raw file URL. */
            async function createGist(token, content) {
                try {
                    const response = await fetch('https://api.github.com/gists', {
                        method: 'POST',
                        headers: { 'Authorization': `token ${token}`, 'Accept': 'application/vnd.github.v3+json' },
                        body: JSON.stringify({
                            description: 'Hosted with Page Cast',
                            public: true,
                            files: { 'index.html': { content: content } }
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw { status: response.status, data: errorData };
                    }
                    const data = await response.json();
                    return data.files['index.html'].raw_url;
                } catch (error) {
                    if (error instanceof TypeError) {
                        throw { isNetworkError: true };
                    }
                    throw error;
                }
            }

            /** Converts a GitHub raw content URL to a githack CDN URL. */
            function convertToGithack(rawUrl) {
                if (!rawUrl || !rawUrl.includes('gist.githubusercontent.com')) {
                    throw new Error("Invalid raw Gist URL provided.");
                }
                return rawUrl.replace('gist.githubusercontent.com', 'gistcdn.githack.com');
            }

            /** Delays function execution to improve performance. */
            function debounce(func, delay) {
                let timeoutId;
                return (...args) => {
                    clearTimeout(timeoutId);
                    timeoutId = setTimeout(() => func.apply(this, args), delay);
                };
            }
        });
    </script>

</body>
</html>
